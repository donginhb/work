<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ZipArchive: ZipStorage.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff" leftmargin="32" marginwidth="32" topmargin="32" marginheight="32">
<!-- Generated by Doxygen 1.4.1 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">D:</a>&nbsp;/&nbsp;<a class="el" href="dir_000001.html">Moje dokumenty</a>&nbsp;/&nbsp;<a class="el" href="dir_000002.html">Visual</a>&nbsp;/&nbsp;<a class="el" href="dir_000003.html">ZipArchive</a>&nbsp;/&nbsp;<a class="el" href="dir_000004.html">_temp</a>&nbsp;/&nbsp;<a class="el" href="dir_000005.html">ZipArchive</a></div>
<h1>ZipStorage.h</h1><a href="ZipStorage_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00002 <span class="comment">// $RCSfile: ZipStorage.h,v $</span>
00003 <span class="comment">// $Revision: 1.5 $</span>
00004 <span class="comment">// $Date: 2005/07/22 20:46:18 $ $Author: Tadeusz Dracz $</span>
00006 <span class="comment"></span><span class="comment">// This source file is part of the ZipArchive library source distribution and</span>
00007 <span class="comment">// is Copyrighted 2000-2005 by Tadeusz Dracz (http://www.artpol-software.com/)</span>
00008 <span class="comment">//</span>
00009 <span class="comment">// This program is free software; you can redistribute it and/or</span>
00010 <span class="comment">// modify it under the terms of the GNU General Public License</span>
00011 <span class="comment">// as published by the Free Software Foundation; either version 2</span>
00012 <span class="comment">// of the License, or (at your option) any later version.</span>
00013 <span class="comment">// </span>
00014 <span class="comment">// For the licensing details see the file License.txt</span>
00016 <span class="comment"></span>
00023 <span class="preprocessor">#if !defined(AFX_ZIPSTORAGE_H__941824FE_3320_4794_BDE3_BE334ED8984B__INCLUDED_)</span>
00024 <span class="preprocessor"></span><span class="preprocessor">#define AFX_ZIPSTORAGE_H__941824FE_3320_4794_BDE3_BE334ED8984B__INCLUDED_</span>
00025 <span class="preprocessor"></span>
00026 <span class="preprocessor">#if _MSC_VER &gt; 1000</span>
00027 <span class="preprocessor"></span><span class="preprocessor">#pragma once</span>
00028 <span class="preprocessor"></span><span class="preprocessor">#endif // _MSC_VER &gt; 1000</span>
00029 <span class="preprocessor"></span>
00030 <span class="preprocessor">#include "ZipFile.h"</span> 
00031 <span class="preprocessor">#include "<a class="code" href="ZipAutoBuffer_8h.html">ZipAutoBuffer.h</a>"</span>
00032 <span class="preprocessor">#include "ZipString.h"</span>
00033 <span class="preprocessor">#include "<a class="code" href="ZipMemFile_8h.html">ZipMemFile.h</a>"</span>
00034 <span class="preprocessor">#include "ZipExport.h"</span>
00035 
00036 
00037 
<a name="l00044"></a><a class="code" href="structCZipCallback.html">00044</a> <span class="keyword">struct </span>ZIP_API CZipCallback
00045 {
00062  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> Callback(<span class="keywordtype">int</span> iProgress) = 0;
00063 
00064 
<a name="l00065"></a><a class="code" href="structCZipCallback.html#o0">00065</a>  CZipString m_szExternalFile; 
00066 };
00067 
<a name="l00084"></a><a class="code" href="structCZipSpanCallback.html">00084</a> <span class="keyword">struct </span>ZIP_API CZipSpanCallback : <span class="keyword">public</span> CZipCallback
00085 {
<a name="l00086"></a><a class="code" href="structCZipSpanCallback.html#o0">00086</a>  DWORD m_uDiskNeeded;  
00087 };
00088 
00089 
00090 
<a name="l00101"></a><a class="code" href="structCZipActionCallback.html">00101</a> <span class="keyword">struct </span>ZIP_API CZipActionCallback : <span class="keyword">public</span> CZipCallback
00102 {
00103 
00104  CZipActionCallback()
00105  {  
00106   m_uTotalToDo = 0;
00107   m_uTotalSoFar = 0;
00108  }
00109  
<a name="l00114"></a><a class="code" href="structCZipActionCallback.html#o0">00114</a>  <span class="keywordtype">int</span> m_iType;
00115 
<a name="l00120"></a><a class="code" href="structCZipActionCallback.html#a1">00120</a>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> Init(LPCTSTR lpszFileInZip = NULL, LPCTSTR lpszExternalFile = NULL) 
00121  {
00122   m_szFileInZip = lpszFileInZip;
00123   m_szExternalFile = lpszExternalFile;
00124   m_uTotalToDo = 0;  <span class="comment">// not yet known</span>
00125   m_uTotalSoFar = 0; <span class="comment">// nothing yet done</span>
00126  }
00127 
<a name="l00133"></a><a class="code" href="structCZipActionCallback.html#a2">00133</a>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> SetTotal(DWORD uTotalToDo)
00134  {
00135   m_uTotalToDo = uTotalToDo;
00136 <span class="comment">//   m_uTotalSoFar = 0; // already done in CZipArchive::CZipClbckStrg::Get</span>
00137  }
00138 
00139 
00140 
<a name="l00151"></a><a class="code" href="structCZipActionCallback.html#o1">00151</a>  DWORD m_uTotalToDo;    
<a name="l00152"></a><a class="code" href="structCZipActionCallback.html#o2">00152</a>  DWORD m_uTotalSoFar;   
<a name="l00153"></a><a class="code" href="structCZipActionCallback.html#o3">00153</a>  CZipString m_szFileInZip;  
00154 
00155 
<a name="l00159"></a><a class="code" href="structCZipActionCallback.html#a3">00159</a>  DWORD LeftToDo() {<span class="keywordflow">return</span> m_uTotalToDo - m_uTotalSoFar;}
00160 
00161 
<a name="l00166"></a><a class="code" href="structCZipActionCallback.html#a4">00166</a>  <span class="keyword">virtual</span> <span class="keywordtype">void</span> CallbackEnd()
00167  {
00168   ASSERT(m_uTotalSoFar == m_uTotalToDo);
00169  };
00170 
<a name="l00174"></a><a class="code" href="structCZipActionCallback.html#a5">00174</a>  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> operator()(<span class="keywordtype">int</span> iProgress)
00175  {
00176   m_uTotalSoFar += iProgress;
00177   <span class="keywordflow">return</span> <a class="code" href="structCZipCallback.html#a0">Callback</a>(iProgress);
00178  }
00179 
<a name="l00188"></a><a class="code" href="structCZipActionCallback.html#s0">00188</a>  <span class="keyword">static</span> <span class="keywordtype">int</span> m_iStep;
00189 
00190 
<a name="l00194"></a><a class="code" href="structCZipActionCallback.html#a6">00194</a>  <span class="keywordtype">int</span> GetStep(){<span class="keywordflow">return</span> m_iStep ? m_iStep : 1;} <span class="comment">// do not allow 0 (crash)</span>
00195   
00196 };
00197 
00198 
<a name="l00202"></a><a class="code" href="classCZipStorage.html">00202</a> <span class="keyword">class </span>ZIP_API CZipStorage  
00203 {
00204  <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classCZipCentralDir.html">CZipCentralDir</a>;
00205 <span class="keyword">public</span>:
00206  
<a name="l00211"></a><a class="code" href="classCZipStorage.html#w5">00211</a>  <span class="keyword">enum</span> ZipSpanMode {
00212   noSpan,   
00213   pkzipSpan,  
00214   tdSpan,   
00215 
00220   suggestedAuto, 
00225   suggestedTd
00226  };
00227 
00228  CZipStorage();
00229  <span class="keyword">virtual</span> ~CZipStorage();
00230 
00241  <span class="keywordtype">void</span> Open(CZipAbstractFile&amp; af, <span class="keywordtype">int</span> iMode);
00242 
00253  <span class="keywordtype">void</span> Open(LPCTSTR szPathName, <span class="keywordtype">int</span> iMode, <span class="keywordtype">int</span> iVolumeSize);
00254 
00255 
00259  <span class="keywordtype">void</span> FinalizeSpan();
00260 
00261  
00269  <span class="keywordtype">void</span> UpdateSpanMode(WORD uLastDisk);
00270 
00271 
00272 
00280  DWORD AssureFree(DWORD iNeeded);
00281 
00293  <span class="keywordtype">void</span> <a class="code" href="ZipFileHeader_8h.html#a1">Write</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *pBuf, DWORD iSize, <span class="keywordtype">bool</span> bAtOnce);
00294 
00306  DWORD <a class="code" href="classCZipCentralDir.html#a3">Read</a>(<span class="keywordtype">void</span>* pBuf, DWORD iSize, <span class="keywordtype">bool</span> bAtOnce);
00307 
<a name="l00312"></a><a class="code" href="classCZipStorage.html#a9">00312</a>  DWORD GetPosition()<span class="keyword"> const </span>{<span class="keywordflow">return</span> (DWORD)(m_pFile-&gt;GetPosition()) + m_uBytesInWriteBuffer;}
00313 
00314 
00319  <span class="keywordtype">void</span> Flush();
00320 
00321 
<a name="l00325"></a><a class="code" href="classCZipStorage.html#a11">00325</a>  <span class="keywordtype">void</span> <a class="code" href="namespaceZipPlatform.html#a20">FlushFile</a>()
00326  {
00327   <span class="keywordflow">if</span> (!<a class="code" href="ZipStorage_8h.html#a3">m_bInMemory</a> &amp;&amp; !IsReadOnly())
00328    m_pFile-&gt;Flush();
00329  }
00330 
00339  <span class="keywordtype">void</span> NextDisk(<span class="keywordtype">int</span> iNeeded, LPCTSTR lpszFileName = NULL);
00340 
00341 
<a name="l00345"></a><a class="code" href="classCZipStorage.html#a13">00345</a>  <span class="keywordtype">int</span> GetCurrentDisk()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="ZipStorage_8h.html#a2">m_iCurrentDisk</a>;}
00346 
00347  
00354  <span class="keywordtype">void</span> ChangeDisk(<span class="keywordtype">int</span> iNumber);
00355 
<a name="l00364"></a><a class="code" href="classCZipStorage.html#a15">00364</a>  <span class="keywordtype">int</span> IsSpanMode()<span class="keyword"> const</span>
00365 <span class="keyword"> </span>{
00366   <span class="keywordflow">return</span> m_iSpanMode == noSpan ? 0 : (<a class="code" href="ZipStorage_8h.html#a1">m_bNewSpan</a> ? 1 : -1);
00367  }
00368 
<a name="l00372"></a><a class="code" href="classCZipStorage.html#a16">00372</a>  <span class="keywordtype">bool</span> IsReadOnly()
00373  {
00374   <span class="keywordflow">return</span> <a class="code" href="ZipStorage_8h.html#a4">m_bReadOnly</a> || IsSpanMode() &lt; 0;
00375  }
00376 
00387  CZipString Close(<span class="keywordtype">bool</span> bAfterException);
00388 
00389 
<a name="l00397"></a><a class="code" href="classCZipStorage.html#o0">00397</a>  <span class="keywordtype">int</span> m_iWriteBufferSize;
00398 
00399 
<a name="l00405"></a><a class="code" href="classCZipStorage.html#o1">00405</a>  CZipFile m_internalfile;
00406 
<a name="l00416"></a><a class="code" href="classCZipStorage.html#o2">00416</a>  CZipAbstractFile* m_pFile; 
00417 
<a name="l00421"></a><a class="code" href="classCZipStorage.html#o3">00421</a>  <span class="keywordtype">int</span> m_iSpanMode;
00422 
<a name="l00428"></a><a class="code" href="classCZipStorage.html#o4">00428</a>  CZipSpanCallback* m_pChangeDiskFunc;
00429 
<a name="l00433"></a><a class="code" href="classCZipStorage.html#s0">00433</a>  <span class="keyword">static</span> <span class="keywordtype">char</span> m_gszExtHeaderSignat[];
00434 <span class="keyword">protected</span>:
00435 
<a name="l00439"></a><a class="code" href="classCZipStorage.html#b0">00439</a>  <span class="keywordtype">void</span> EmptyWriteBuffer()
00440  {
00441   m_uBytesInWriteBuffer = 0;
00442  }
00443 
00454  <span class="keywordtype">bool</span> <a class="code" href="classCZipCentralDir.html#a4">OpenFile</a>(LPCTSTR lpszName, UINT uFlags, <span class="keywordtype">bool</span> bThrow = <span class="keyword">true</span>);
00460  <span class="keywordtype">void</span> <a class="code" href="ZipCentralDir_8h.html#a3">ThrowError</a>(<span class="keywordtype">int</span> err);
00461 
00465  DWORD VolumeLeft() <span class="keyword">const</span>;
00466 
00470  CZipString RenameLastFileInTDSpan();
00479  <span class="keywordtype">void</span> WriteInternalBuffer(<span class="keyword">const</span> <span class="keywordtype">char</span> *pBuf, DWORD uSize);
00480 
00484  DWORD GetFreeVolumeSpace() <span class="keyword">const</span>;
00485 
00498  <span class="keywordtype">void</span> CallCallback(<span class="keywordtype">int</span> iCode, CZipString szTemp);
00499 
00500 
00510  CZipString GetTdVolumeName(<span class="keywordtype">bool</span> bLast, LPCTSTR lpszZipName = NULL) <span class="keyword">const</span>;
00511 
00515  CZipString ChangeTdRead();
00516 
00520  CZipString ChangePkzipRead();
00521  
00522 
<a name="l00533"></a><a class="code" href="classCZipStorage.html#p0">00533</a>  <span class="keywordtype">int</span> m_iTdSpanData;
00534  
<a name="l00538"></a><a class="code" href="classCZipStorage.html#p1">00538</a>  CZipString m_szSpanExtension;
00539 
<a name="l00543"></a><a class="code" href="classCZipStorage.html#b11">00543</a>  DWORD GetFreeInBuffer()<span class="keyword"> const </span>{<span class="keywordflow">return</span> m_pWriteBuffer.GetSize() - m_uBytesInWriteBuffer;}
00544  
<a name="l00548"></a><a class="code" href="classCZipStorage.html#p2">00548</a>  DWORD m_uBytesInWriteBuffer;
00549 
<a name="l00556"></a><a class="code" href="classCZipStorage.html#p3">00556</a>  DWORD m_uCurrentVolSize;
00557 
00558 
<a name="l00562"></a><a class="code" href="classCZipStorage.html#p4">00562</a>  DWORD m_uVolumeFreeInBuffer;
00563 
<a name="l00567"></a><a class="code" href="classCZipStorage.html#p5">00567</a>  <a class="code" href="classCZipAutoBuffer.html">CZipAutoBuffer</a> m_pWriteBuffer;
00568 
00569 
<a name="l00574"></a><a class="code" href="classCZipStorage.html#p6">00574</a>  DWORD m_iBytesWritten;
00575 
<a name="l00579"></a><a class="code" href="classCZipStorage.html#p7">00579</a>  <span class="keywordtype">bool</span> <a class="code" href="ZipStorage_8h.html#a1">m_bNewSpan</a>;
00580 
<a name="l00585"></a><a class="code" href="classCZipStorage.html#p8">00585</a>  <span class="keywordtype">int</span> <a class="code" href="ZipStorage_8h.html#a2">m_iCurrentDisk</a>;
00586 
<a name="l00590"></a><a class="code" href="classCZipStorage.html#p9">00590</a>  <span class="keywordtype">bool</span> <a class="code" href="ZipStorage_8h.html#a3">m_bInMemory</a>;
00591 
<a name="l00595"></a><a class="code" href="classCZipStorage.html#p10">00595</a>  <span class="keywordtype">bool</span> <a class="code" href="ZipStorage_8h.html#a4">m_bReadOnly</a>;
00596  
00597 };
00598 
00599 <span class="preprocessor">#endif // !defined(AFX_ZIPSTORAGE_H__941824FE_3320_4794_BDE3_BE334ED8984B__INCLUDED_)</span>
</pre></div><hr><address><small>
ZipArchive Copyright &copy;&nbsp;2000-2005 <a href="mailto:tdracz@artpol-software.com"> Tadeusz Dracz </a>. Generated at Fri Aug 5 21:44:50 2005.
</small></address>
</body>
</html>
